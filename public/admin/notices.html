<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Upload Notices / Circulars</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#f5f5f5; }
form { margin-bottom:20px; }
input, textarea { width:100%; margin-bottom:10px; padding:8px; }
button { padding:10px 20px; }
table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#007bff; color:white; }
a { color:#007bff; text-decoration:none; }
</style>
</head>
<body>
<h2>Upload Notices / Circulars</h2>
<form id="uploadForm">
  <input type="text" name="title" placeholder="Title" required>
  <textarea name="description" placeholder="Description"></textarea>
  <input type="file" name="file">
  <button type="submit">Upload</button>
</form>

<h3>All Notices</h3>
<table id="noticesTable">
<thead>
<tr><th>ID</th><th>Title</th><th>Description</th><th>File</th><th>Date</th><th>Action</th></tr>
</thead>
<tbody></tbody>
</table>

<script>
const uploadForm = document.getElementById("uploadForm");
uploadForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData(uploadForm);
  const res = await fetch('/admin/api/notices', { method:'POST', body: formData });
  const data = await res.json();
  alert(data.message);
  if(data.success) fetchNotices();
});

async function fetchNotices(){
  const res = await fetch('/student/api/notices'); // reuse API
  const data = await res.json();
  const tbody = document.querySelector("#noticesTable tbody");
  tbody.innerHTML = '';
  if(data.success){
    data.notices.forEach(n => {
      const fileLink = n.file_path ? `<a href="${n.file_path}" target="_blank">Download</a>` : '';
      tbody.innerHTML += `
        <tr>
          <td>${n.id}</td>
          <td>${n.title}</td>
          <td>${n.description || ''}</td>
          <td>${fileLink}</td>
          <td>${new Date(n.created_at).toLocaleString()}</td>
          <td><button onclick="deleteNotice(${n.id})">Delete</button></td>
        </tr>
      `;
    });
  }
}

async function deleteNotice(id){
  if(!confirm("Are you sure?")) return;
  const res = await fetch(`/admin/api/notices/${id}`, { method:'DELETE' });
  const data = await res.json();
  alert(data.message);
  if(data.success) fetchNotices();
}

fetchNotices();
</script>
</body>
</html>
