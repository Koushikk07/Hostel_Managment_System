<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Complaints</title>
<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; margin:0; padding:0; }
header { background: #007bff; color: white; padding: 16px; text-align: center; }
h1 { margin:0; font-size:24px; }
main { padding:24px; background:white; margin:16px; border-radius:6px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
input, select, textarea { width:100%; padding:8px; margin:6px 0; border-radius:4px; border:1px solid #ccc; }
button { padding:8px 16px; margin-top:6px; border:none; background:#007bff; color:white; border-radius:4px; cursor:pointer; }
button:hover { background:#0056b3; }
table { width:100%; border-collapse:collapse; margin-top:12px; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#007bff; color:white; }
.status { font-weight:bold; }
.pending { color:orange; }
.resolved { color:green; }
header {
  background: #007bff;
  color: white;
  padding: 16px 24px;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
}
header h1 {
  margin: 0;
  font-size: 24px;
  flex: 1;
  text-align: center;
}
header a {
  position: absolute;
  left: 24px;
  top: 50%;
  transform: translateY(-50%);
  text-decoration: none;
  background: white;
  color: #007bff;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: bold;
  transition: background 0.3s, color 0.3s;
}
header a:hover {
  background: #0056b3;
 color:Â white;
}
</style>
</head>
<body>

<header>
  <h1>Complaints</h1>
   <a href="dashboard.html">Back</a>
</header>

<main>
<h2>Submit Complaint</h2>
<form id="complaint-form">
  <label for="type">Complaint Type</label>
  <select id="type" name="complaint_type" required>
    <option value="">Select Type</option>
    <option value="Maintenance">Maintenance</option>
    <option value="Mess">Mess</option>
    <option value="Other">Other</option>
  </select>

  <label for="desc">Description</label>
  <textarea id="desc" name="description" rows="4" required></textarea>

  <button type="submit">Submit Complaint</button>
</form>
<div id="msg"></div>

<h2>My Complaints</h2>
<div id="complaints-list">Loading...</div>

<script>
async function loadComplaints() {
  const container = document.getElementById("complaints-list");
  try {
    const resProfile = await fetch("/student/profile");
    const profile = await resProfile.json();
    const student_id = profile.student.id;

    const res = await fetch("/my-complaints");
    const data = await res.json();

    if (!data.success || !data.complaints.length) {
      container.innerHTML = "<p>No complaints submitted yet.</p>";
      return;
    }

    let html = `<table>
      <tr><th>ID</th><th>Type</th><th>Description</th><th>Status</th><th>Date</th></tr>`;

    data.complaints.forEach(c => {
      html += `
        <tr>
          <td>${c.complaint_id}</td>
          <td>${c.complaint_type}</td>
          <td>${c.description}</td>
          <td class="status ${c.status.toLowerCase()}">${c.status}</td>
          <td>${new Date(c.created_at).toLocaleDateString()}</td>
        </tr>
      `;
    });

    html += `</table>`;
    container.innerHTML = html;

  } catch(err) {
    container.innerHTML = "<p>Error loading complaints</p>";
  }
}

// ================= Submit Complaint =================
document.getElementById("complaint-form").addEventListener("submit", async function(e) {
  e.preventDefault();
  const type = document.getElementById("type").value;
  const desc = document.getElementById("desc").value;

  if (!type || !desc) return;

  try {
    const resProfile = await fetch("/student/profile");
    const profile = await resProfile.json();
    const student_id = profile.student.id;

    const res = await fetch("/complaints", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ student_id, complaint_type: type, description: desc })
    });

    const data = await res.json();
    document.getElementById("msg").innerText = data.message || "Complaint submitted";
    loadComplaints();
    document.getElementById("complaint-form").reset();
  } catch(err) {
    document.getElementById("msg").innerText = "Error submitting complaint";
  }
});

// ================= Initial Load =================
loadComplaints();
</script>
</main>

</body>
</html>
