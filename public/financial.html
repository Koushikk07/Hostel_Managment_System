<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Finance</title>
<style>
body{font-family:Arial,sans-serif;background:#f5f5f5;margin:0;padding:0}
header{background:#007bff;color:white;padding:16px;text-align:center}
table{border-collapse:collapse;width:100%;margin:16px 0}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#007bff;color:white}
h2{color:#007bff;margin-top:24px}
.total-row{font-weight:bold;background:#e0e0e0}
</style>
</head>
<body>
<header><h1>Finance Details</h1></header>
<main>
<div id="finance-container">Loading...</div>
</main>

<script>
async function loadFinance(){
  const container = document.getElementById("finance-container");
  try{
    const profileRes = await fetch("/student/profile");
    const profileData = await profileRes.json();
    if(!profileData.success) throw new Error("Profile not found");
    const student = profileData.student;

    let html = `<p><strong>${student.name}</strong> | Roll: ${student.roll_no} | Branch: ${student.branch || '-'} | Room: ${student.room_no || '-'} | Hostel: ${student.hostel_name || '-'}</p>`;

    const financeRes = await fetch("/api/finance/" + student.roll_no);
    const financeData = await financeRes.json();

    if(!financeData.success || !financeData.years.length){
      container.innerHTML = html + "<p>No finance records available.</p>";
      return;
    }

    financeData.years.forEach(year => {
      html += `<h2>Academic Year: ${year.year}</h2>`;
      html += `<table>
        <thead>
          <tr>
            <th>#</th><th>Month</th><th>Monthly Fee</th><th>Paid</th>
            <th>Scholarship</th><th>Remaining</th><th>Due</th>
          </tr>
        </thead>
        <tbody>`;
      year.records.forEach(r => {
        html += `<tr class="${r.id=='#'?'total-row':''}">
          <td>${r.id}</td>
          <td>${r.month}</td>
          <td>${r.fee}</td>
          <td>${r.paid}</td>
          <td>${r.scholarship}</td>
          <td>${r.remaining}</td>
          <td>${r.due}</td>
        </tr>`;
      });
      html += `</tbody></table>`;
    });

    container.innerHTML = html;
  }catch(err){
    container.innerHTML = `<p>Error loading finance data</p>`;
    console.error(err);
  }
}

loadFinance();
</script>
</body>
</html>
